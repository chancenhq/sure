<%# locals: (user:) %>

<% partner_params = { partner_key: active_partner_key } %>
<% steps = [
  {
    key: :setup,
    name: current_partner&.translation(:onboarding, :nav, :setup, default: t("partner_onboardings.nav.setup")),
    path: partner_onboarding_path(partner_params),
    is_complete: user.first_name.present?,
    step_number: 1
  },
  {
    key: :preferences,
    name: current_partner&.translation(:onboarding, :nav, :preferences, default: t("partner_onboardings.nav.preferences")),
    path: preferences_partner_onboarding_path(partner_params),
    is_complete: user.set_onboarding_preferences_at.present?,
    step_number: 2
  },
  {
    key: :goals,
    name: current_partner&.translation(:onboarding, :nav, :goals, default: t("partner_onboardings.nav.goals")),
    path: goals_partner_onboarding_path(partner_params),
    is_complete: user.set_onboarding_goals_at.present?,
    step_number: 3
  },
  {
    key: :trial,
    name: current_partner&.translation(:onboarding, :nav, :trial, default: t("partner_onboardings.nav.trial")),
    path: trial_partner_onboarding_path(partner_params),
    is_complete: user.onboarded?,
    step_number: 4
  }
] %>

<%# Don't show last step if self hosted %>
<% steps.pop if self_hosted? %>

<ul class="hidden md:flex items-center gap-2">
  <% steps.each_with_index do |step, idx| %>
    <li class="flex items-center gap-2 group">
      <% is_current = request.path == step[:path] %>

      <% text_class = if is_current
                  "text-primary"
                else
                  step[:is_complete] ? "text-green-600" : "text-secondary"
                end %>
      <% step_class = if is_current
                  "bg-surface-inset text-primary"
                else
                  step[:is_complete] ? "bg-green-600/10 border-alpha-black-25" : "bg-container-inset"
                end %>

      <%= link_to step[:path], class: "flex items-center gap-3" do %>
        <div class="flex items-center gap-2 text-sm font-medium <%= text_class %>">
          <span class="<%= step_class %> w-7 h-7 rounded-full shrink-0 inline-flex items-center justify-center border border-transparent">
            <%= step[:is_complete] && !is_current ? icon("check", size: "sm", color: "current") : idx + 1 %>
          </span>

          <span><%= step[:name] %></span>
        </div>
      <% end %>

      <hr class="border border-secondary w-12 group-last:hidden">
    </li>
  <% end %>
</ul>
